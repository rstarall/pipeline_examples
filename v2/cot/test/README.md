# LightRAG流式接口测试工具

本目录包含用于测试LightRAG流式接口的测试脚本，主要测试 `http://117.50.252.245:9621/query/stream` 接口的流式输出功能。

## 📋 文件说明

### 1. test_lightrag_stream.py
完整的测试套件，包含多个测试用例和详细的输出信息。

**功能特点：**
- 服务健康检查
- 多种查询模式测试（hybrid、local、global）
- 中英文查询测试
- 详细的流式数据分析
- 完整的测试报告

### 2. quick_test.py
简化的快速测试脚本，用于单次查询测试。

**功能特点：**
- 快速单次查询测试
- 实时显示流式输出
- 简洁的输出格式
- 支持自定义参数

## 🚀 使用方法

### 完整测试套件

```bash
# 使用默认服务地址
python test_lightrag_stream.py

# 使用自定义服务地址
python test_lightrag_stream.py http://your-server:port
```

### 快速测试

```bash
# 使用默认参数
python quick_test.py

# 自定义服务地址
python quick_test.py http://117.50.252.245:9621

# 自定义查询内容
python quick_test.py http://117.50.252.245:9621 "什么是机器学习？"

# 自定义所有参数
python quick_test.py http://117.50.252.245:9621 "什么是深度学习？" hybrid
```

## 📊 测试内容

### 测试的查询模式
- **hybrid**: 混合模式（默认）
- **local**: 本地检索模式
- **global**: 全局检索模式

### 测试的查询类型
- 中文查询：测试中文文本处理能力
- 英文查询：测试英文文本处理能力
- 技术查询：测试专业术语处理能力

## 🔧 接口规格

### 请求格式
```json
POST /query/stream
Content-Type: application/json
Accept: application/x-ndjson

{
    "query": "查询内容",
    "mode": "hybrid"
}
```

### 响应格式
流式NDJSON响应，每行一个JSON对象：

```json
{"response": "响应内容片段1"}
{"response": "响应内容片段2"}
...
```

错误响应：
```json
{"error": "错误信息"}
```

## 📈 输出示例

### 成功测试输出
```
🚀 快速测试LightRAG流式接口
🌐 服务地址: http://117.50.252.245:9621
📝 查询内容: 什么是人工智能？
🔧 查询模式: hybrid
📡 请求URL: http://117.50.252.245:9621/query/stream
============================================================
📤 发送请求...
📡 HTTP状态码: 200

📨 接收流式数据:
----------------------------------------
[14:30:15.123] 📝 人工智能（Artificial Intelligence，AI）是计算机科学的一个分支...
[14:30:15.456] 📝 它旨在创建能够执行通常需要人类智能的任务的计算机系统...
[14:30:15.789] 📝 包括学习、推理、问题解决、感知和语言理解等。

============================================================
✅ 流式查询完成!
📊 统计信息:
   - 耗时: 2.35 秒
   - 总内容长度: 1256 字符
   - 数据块数量: 15
🎉 测试成功！
```

### 错误测试输出
```
❌ 无法连接到服务: Connection refused
❌ 测试失败！
```

## 🐛 故障排查

### 常见问题

1. **连接超时**
   - 检查服务地址是否正确
   - 确认服务是否正在运行
   - 检查网络连接

2. **HTTP 404错误**
   - 确认接口路径 `/query/stream` 是否正确
   - 检查服务版本是否支持流式接口

3. **JSON解析错误**
   - 检查服务返回的数据格式
   - 确认是否为NDJSON格式

4. **请求超时**
   - 增加超时时间设置
   - 检查查询复杂度

### 调试技巧

1. **查看详细HTTP信息**
   修改脚本中的 `timeout` 和 `chunk_size` 参数

2. **分析原始响应**
   在脚本中添加原始数据打印：
   ```python
   print(f"原始数据: {chunk}")
   ```

## 📋 依赖requirements

```
requests>=2.25.0
```

安装依赖：
```bash
pip install requests
```

---

*该测试工具基于 COT LightRAG Stream Pipeline 的接口规格开发* 